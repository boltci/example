name: Pint

on: push

use: ubuntu:24.04

setup:
  php:
    version: "8.3"

configure:
  max_cores_per_run: 16

preheat:
  extend: run
  run_pint:
      run: echo "Skipped Pint when preheating."
  commit_changes:
      run: echo "Skipped committing changes when preheating."

run:
  install_dependencies:
    watch: composer.lock,composer.json
    run: composer install --no-progress --optimize-autoloader --apcu-autoloader
      && php artisan shards:patch-phpunit
      && php artisan shards:patch-paratest

  run_pint:
    run: ./vendor/bin/pint

  commit_changes:
    run: |
      if [ -n "$(git status --porcelain)" ]; then
        git config user.name "Bolt CI"
        git config user.email "robot@boltci.com"
        git add .
        git commit -m "Apply Pint fixes"
        git push origin HEAD:refs/heads/${BOLTCI_BRANCH}
      else
        echo "No changes to commit."
      fi


